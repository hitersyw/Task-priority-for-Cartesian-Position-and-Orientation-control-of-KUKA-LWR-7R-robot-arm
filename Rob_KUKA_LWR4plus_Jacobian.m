% Rob_KUKA_LWR4plus.m
% Author: Yang ge and Zhang di
clear

syms q1 q2 q3 q4 q5 q6 q7 dq1 dq2 dq3 dq4 dq5 dq6 dq7 ddq1 ddq2 ddq3 ddq4 ddq5 ddq6 ddq7  'real'

q = [q1 q2 q3 q4 q5 q6 q7];
dq = [dq1 dq2 dq3 dq4 dq5 dq6 dq7];
ddq = [ddq1 ddq2 ddq3 ddq4 ddq5 ddq6 ddq7];
q0 = [0 0 0 0 0 0 0];              % Initial joint position
dq0 = [0 0 0 0 0 0 0];
ddq0 = [0 0 0 0 0 0 0];

% Lenghts of each link [m]
l0 = 0.11; 
l1 = 0.2;                           
l2 = 0.2; 
l3 = 0.2;
l4 = 0.2;
l5 = 0.19;
l6 = 0;
l7 = 0;
ee_offset = 0.078;

% Define position of CoM of link i w.r.t RFi 
rc1 = [0.001340         
       -0.087777       
        -0.026220];
rc2 = [0.001340
-0.026220
0.087777];
rc3 = [-0.001340
0.087777
-0.026220];
rc4 = [-0.001340
0.026220
0.087777];
rc5 = [-0.000993
-0.111650
-0.026958];
rc6 = [-0.000259
-0.005956
-0.005328];
rc7 = [0
    0
    0.063];

% Define Inertia matrices of the links around the CoM 
% (cylindrical links with r = 0.10) 
ine1 = [0.016340536683981 0.000003026772299 -0.000000709016801
0.000003026772299 0.005026130247583 0.003533064213839
-0.000000709016801 0.003533064213839 0.016173076285877];
ine2 = [0.016340543235640 -0.000000708736804 0.000003025958460
-0.000000708736804 0.016173082837536 0.003533229970806
0.000003025958460 0.003533229970806 0.005026130575166];
ine3 = [0.016340536683981 -0.000003025038092 -0.000000708435613
-0.000003025038092 0.005026130247583 -0.003533064213839
-0.000000708435613 -0.003533064213839 0.016173076285877];
ine4 = [0.016340536683981 -0.000000708770474 -0.000003026399929
-0.000000708770474 0.016173076285877 -0.003533064213839
-0.000003026399929 -0.003533064213839 0.005026130247583];
ine5 = [0.009818395861149 -0.000001329981455 0.000000761816372
-0.000001329981455 0.003708097004077 0.003093942172699
0.000000761816372 0.003093942172699 0.009092404844472];
ine6 = [0.003011683905727 0.000000005040330 -0.000000115610566
0.000000005040330 0.003022943456485 -0.000019307179987
-0.000000115610566 -0.000019307179987 0.003413632286504];
ine7 = [0.00010171875 0 0
0 0.00010171875 0
0 0 0.0001584375];


% Defining the 3Relbow-type robot
% clear L
d1 = l2+l3;
d2 = l4+l5;
L(1) = Revolute('d', 0, 'a', 0  , 'alpha',sym(pi/2),'m',2.7,'I',ine1,'r',rc1);
L(2) = Revolute('d', 0, 'a', 0, 'alpha', sym(-pi/2)    ,'m',2.7,'I',ine2,'r',rc2);
L(3) = Revolute('d', d1, 'a', 0, 'alpha', sym(-pi/2)    ,'m',2.7,'I',ine3,'r',rc3);
L(4) = Revolute('d', 0, 'a', 0, 'alpha', sym(pi/2)    ,'m',2.7,'I',ine4,'r',rc4);
L(5) = Revolute('d', d2, 'a', 0, 'alpha', sym(pi/2)    ,'m',1.7,'I',ine5,'r',rc5);
L(6) = Revolute('d', 0, 'a', 0, 'alpha', sym(-pi/2)    ,'m',1.6,'I',ine6,'r',rc6);
L(7) = Revolute('d', 0, 'a', 0, 'alpha', 0    ,'m',0.3,'I',ine7,'r',rc7);
R = SerialLink(L, 'name', 'KUKA-LWR4+');

% Jacobian
 J = R.jacob0(q)                           %is the Jacobian matrix (3xn) in world coordinates for the robot in pose Q (1xN), and N is the number of robot joints.